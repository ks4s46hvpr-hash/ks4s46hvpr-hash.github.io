<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026é©¬å¹´è´ºå¡</title>
    <!-- å¼ºåˆ¶è¯·æ±‚ç®€ä½“ä¸­æ–‡å­—ç¬¦é›† -->
    <link rel="stylesheet" href="https://fonts.googleapis.com">
    <style>
        body { font-family: 'Noto Sans SC', 'Microsoft YaHei', sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; background: #f0ebe5; }
        .box { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 380px; text-align: center; }
        h2 { color: #b10405; margin-top: 0; font-size: 22px; }
        input { padding: 12px; width: 85%; border: 1.5px solid #ddd; border-radius: 8px; margin: 15px 0; font-size: 16px; text-align: center; font-weight: bold; outline: none; }
        input:focus { border-color: #b10405; }
        button { padding: 14px 25px; background: #b10405; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 95%; font-size: 16px; }
        .status { font-size: 12px; color: #888; margin-bottom: 10px; }
        .preview-label { margin-top: 10px; font-size: 13px; color: #999; font-weight: bold; }
        canvas { max-width: 100%; margin-top: 10px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); background: #eee; }
        
        /* éšè”½å¼ç‰ˆæƒå£°æ˜ */
        .copyright { margin-top: 30px; font-size: 10px; color: #9a8d83; letter-spacing: 0.2px; text-align: center; line-height: 1.2; opacity: 0.7; }
    </style>
</head>
<body>
    <div class="box">
        <h2>ğŸ§§ 2026 è´ºå¡åˆ¶ä½œ</h2>
        <div id="fontStatus" class="status">æ­£åœ¨å‡†å¤‡é«˜æ¸…ç®€ä½“å­—åº“...</div>
        <input type="text" id="custName" placeholder="è¾“å…¥ä¼ä¸šåç§°" oninput="drawPreview()">
        <button onclick="generate()">ç”Ÿæˆå¹¶ä¸‹è½½</button>
        <div class="preview-label">å®æ—¶é¢„è§ˆ</div>
        <canvas id="previewCanvas"></canvas>
    </div>

    <div class="copyright">
        åˆ¶ä½œï¼šä¸­ç»ç§‘ç¯ xyx@zjqc | Â© 2026 ä¸™åˆé©¬å¹´ä¸“ç”¨
    </div>

    <script>
        const canvas = document.getElementById('previewCanvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.src = "bg.png"; 

        const isWindows = navigator.platform.toLowerCase().includes('win');

        const CONFIG = {
            fontSize: 27,
            color: "#b10405",
            startX_ratio: 0.600,
            startY_ratio: 0.369,
            endX_ratio: 0.844,
            maxLineChars: 15,
            strokeWeight: isWindows ? 0.15 : 0.4 
        };

        document.fonts.ready.then(() => {
            document.getElementById('fontStatus').innerText = `âœ… ç®€ä½“å­—åº“å·²å°±ç»ª (${isWindows ? 'Win 0.2' : 'Mac 0.4'})`;
            if(img.complete) drawPreview();
        });

        img.onload = () => drawPreview();

        function drawContent(targetCanvas) {
            const tCtx = targetCanvas.getContext('2d');
            targetCanvas.width = img.width;
            targetCanvas.height = img.height;
            tCtx.drawImage(img, 0, 0);

            const name = document.getElementById('custName').value.trim();
            if (!name) return;

            const fullText = `è‡´${name}ï¼š`;
            const lineHeight = CONFIG.fontSize * 1.4;
            
            const startX = (targetCanvas.width * CONFIG.startX_ratio) - (CONFIG.fontSize * 0.5);
            const startY = (targetCanvas.height * CONFIG.startY_ratio) - lineHeight;
            const endXLimit = targetCanvas.width * CONFIG.endX_ratio;

            tCtx.font = `900 ${CONFIG.fontSize}px "Noto Sans SC", "Source Han Sans CN", "Microsoft YaHei", sans-serif`;
            tCtx.fillStyle = CONFIG.color;
            tCtx.strokeStyle = CONFIG.color; 
            tCtx.lineWidth = CONFIG.strokeWeight; 
            tCtx.textAlign = "left";
            tCtx.textBaseline = "top";

            let curX = startX;
            let curY = startY;

            for (let i = 0; i < fullText.length; i++) {
                const char = fullText[i];
                const charWidth = tCtx.measureText(char).width;

                const isColon = (char === "ï¼š" || char === ":");
                const shouldWrap = (i > 0 && i % CONFIG.maxLineChars === 0) || (curX + charWidth > endXLimit);

                if (shouldWrap && !isColon) {
                    curX = startX;
                    curY += lineHeight;
                }

                tCtx.fillText(char, curX, curY);
                if (CONFIG.strokeWeight > 0) {
                    tCtx.strokeText(char, curX, curY); 
                }
                curX += charWidth + 2;
            }
        }

        function drawPreview() {
            if (img.complete) drawContent(canvas);
        }

        function generate() {
            const name = document.getElementById('custName').value.trim();
            if(!name) return alert('è¯·è¾“å…¥åç§°');
            drawContent(canvas); 
            
            const dataURL = canvas.toDataURL('image/png', 1.0);
            const isWechat = /MicroMessenger/i.test(navigator.userAgent);

            if (isWechat) {
                const mask = document.createElement('div');
                mask.style.cssText = "position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:999;display:flex;flex-direction:column;align-items:center;padding-top:10%;";
                const imgShow = document.createElement('img');
                imgShow.src = dataURL;
                imgShow.style.cssText = "width:85%;border-radius:8px;box-shadow:0 0 20px rgba(0,0,0,0.5);";
                const tip = document.createElement('p');
                tip.innerHTML = "å·²ç”Ÿæˆé«˜æ¸…è´ºå¡<br>â˜ï¸ é•¿æŒ‰å›¾ç‰‡ä¿å­˜åˆ°ç›¸å†Œ";
                tip.style.cssText = "color:white;margin:20px;text-align:center;font-size:16px;line-height:1.6;";
                const closeBtn = document.createElement('div');
                closeBtn.innerText = "å…³é—­é¢„è§ˆ";
                closeBtn.style.cssText = "margin-top:10px;color:white;border:1px solid #fff;padding:8px 25px;border-radius:20px;font-size:14px;cursor:pointer;";
                closeBtn.onclick = () => document.body.removeChild(mask);
                mask.appendChild(imgShow);
                mask.appendChild(tip);
                mask.appendChild(closeBtn);
                document.body.appendChild(mask);
            } else {
                const link = document.createElement('a');
                link.download = `2026é©¬å¹´è´ºå¡_${name}.png`;
                link.href = dataURL;
                link.click();
            }
        }
    </script>
</body>
</html>
