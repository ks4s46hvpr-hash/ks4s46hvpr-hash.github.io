<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´ºå¡å›¾ç‰‡ç”Ÿæˆå™¨</title>
    <style>
        body { font-family: 'Microsoft YaHei', sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; background: #f8f9fa; }
        .box { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 320px; text-align: center; margin-bottom: 20px; }
        h2 { color: #d63031; margin-bottom: 20px; }
        input { padding: 12px; width: 85%; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; outline: none; }
        button { padding: 12px; background: #27ae60; color: white; border: none; border-radius: 8px; cursor: pointer; width: 95%; margin-top: 10px; font-weight: bold; font-size: 16px; }
        canvas { max-width: 100%; border-radius: 8px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); display: none; }
        .tip { font-size: 13px; color: #666; margin-top: 15px; }
    </style>
</head>
<body>
    <div class="box">
        <h2>ğŸ§§ è´ºå¡ç”Ÿæˆå·¥å…·</h2>
        <input type="text" id="custName" placeholder="è¾“å…¥å®¢æˆ·å§“å">
        <input type="text" id="custDate" placeholder="æ˜¾ç¤ºæ—¥æœŸ (å¯é€‰)">
        <button onclick="generateCard()">ç”Ÿæˆå¹¶ä¸‹è½½è´ºå¡å›¾ç‰‡</button>
        <p class="tip">å¡«å†™ä¿¡æ¯åç‚¹å‡»ç”Ÿæˆï¼Œå›¾ç‰‡å°†è‡ªåŠ¨ä¿å­˜</p>
    </div>

    <!-- é¢„è§ˆåŒºåŸŸ -->
    <canvas id="cardCanvas"></canvas>

    <script>
        // 1. è®¾ç½®é»˜è®¤æ—¥æœŸ
        const today = new Date();
        document.getElementById('custDate').value = `${today.getFullYear()}å¹´${today.getMonth()+1}æœˆ`;

        async function generateCard() {
            const name = document.getElementById('custName').value;
            const date = document.getElementById('custDate').value;
            if(!name) return alert('è¯·è¾“å…¥å®¢æˆ·å§“å');

            const canvas = document.getElementById('cardCanvas');
            const ctx = canvas.getContext('2d');
            
            // 2. åŠ è½½ä½ ä¸Šä¼ çš„ bg.jpg
            const img = new Image();
            img.crossOrigin = "anonymous"; // è§£å†³è·¨åŸŸé—®é¢˜
            img.src = "bg.jpg"; // ç¡®ä¿ä½ åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ä¸Šä¼ äº† bg.jpg

            img.onload = function() {
                // 3. æ ¹æ®å›¾ç‰‡åŸå§‹å¤§å°è®¾ç½®ç”»å¸ƒ
                canvas.width = img.width;
                canvas.height = img.height;
                
                // 4. ç»˜åˆ¶èƒŒæ™¯å›¾
                ctx.drawImage(img, 0, 0);

                // 5. ç»˜åˆ¶æ–‡å­— (è¿™é‡Œä½ å¯ä»¥æ ¹æ®ä½ çš„è®¾è®¡ç¨¿å¾®è°ƒåæ ‡å’Œé¢œè‰²)
                // åå­—æ ·å¼
                ctx.fillStyle = "#d4af37"; // é‡‘è‰²æ–‡å­—ï¼Œå¯æ ¹æ®è®¾è®¡ç¨¿æ”¹ä¸º #ffffff ç­‰
                ctx.font = `bold ${canvas.width * 0.06}px sans-serif`; // æ ¹æ®å®½åº¦è‡ªåŠ¨ç¼©æ”¾å­—å·
                ctx.textAlign = "center";
                
                // æ ¸å¿ƒï¼šåå­—ç”»åœ¨å›¾ç‰‡é«˜åº¦ 40% çš„ä½ç½® (ä½ å¯ä»¥ä¿®æ”¹ 0.4 è¿™ä¸ªç³»æ•°)
                ctx.fillText(name, canvas.width / 2, canvas.height * 0.4);

                // æ—¥æœŸæ ·å¼ (å¯é€‰)
                if(date) {
                    ctx.fillStyle = "rgba(255,255,255,0.8)";
                    ctx.font = `${canvas.width * 0.03}px sans-serif`;
                    ctx.fillText(date, canvas.width / 2, canvas.height * 0.9); // æ—¥æœŸç”»åœ¨åº•éƒ¨ 90% å¤„
                }

                // 6. å±•ç¤ºå¹¶è§¦å‘ä¸‹è½½
                canvas.style.display = "block";
                const dataURL = canvas.toDataURL('image/jpeg', 0.9); // é«˜è´¨é‡è¾“å‡º
                
                const link = document.createElement('a');
                link.download = `${name}çš„ä¸“å±è´ºå¡.jpg`;
                link.href = dataURL;
                link.click();
            };

            img.onerror = function() {
                alert("æœªæ‰¾åˆ°èƒŒæ™¯å›¾ bg.jpgï¼Œè¯·å…ˆå°†è®¾è®¡å¥½çš„ bg.jpg ä¸Šä¼ åˆ° GitHub çš„ card æ–‡ä»¶å¤¹ä¸­ï¼");
            };
        }
    </script>
</body>
</html>
