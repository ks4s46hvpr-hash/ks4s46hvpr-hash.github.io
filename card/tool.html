<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´ºå¡ç”Ÿæˆå·¥å…· - æœ€ç»ˆç¨³å®šç‰ˆ</title>
    <!-- ä½¿ç”¨è¿™ä¸ªå¤‡ç”¨ä¸”æ›´å¿«çš„ CDNï¼Œå¹¶å¢åŠ åŠ è½½æ£€æŸ¥ -->
    <script src="https://lib.baomitu.com"></script>
    <style>
        body { font-family: 'Microsoft YaHei', sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; background: #fff5f5; }
        .box { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); width: 320px; text-align: center; border: 1px solid #ffcfcf; }
        h2 { color: #d63031; margin-top: 0; }
        input { padding: 12px; width: 85%; margin: 10px 0; border: 2px solid #ffcfcf; border-radius: 8px; outline: none; }
        button { padding: 12px; background: #ff4757; color: white; border: none; border-radius: 8px; cursor: pointer; width: 95%; margin-top: 10px; font-weight: bold; font-size: 16px; }
        button:active { background: #e84118; }
        #canvas-container { margin-top: 20px; display: none; }
        canvas { max-width: 100%; border-radius: 10px; box-shadow: 0 8px 25px rgba(0,0,0,0.15); border: 4px solid #fff; }
        .tip { font-size: 14px; color: #ff7675; margin-top: 12px; font-weight: bold; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>
    <div class="box">
        <h2>ğŸ§§ è´ºå¡ç”Ÿæˆå·¥å…·</h2>
        <input type="text" id="custName" placeholder="å®¢æˆ·å°Šç§° (å¦‚: ç‹æ€»)">
        <input type="text" id="custDate" placeholder="æ—¥æœŸ (å¦‚: 2025å¹´2æœˆ)">
        <button onclick="generatePoster()">ç”ŸæˆäºŒç»´ç å¼•å¯¼å›¾</button>
        <p id="statusTip" class="tip" style="display:none;">â†“ é•¿æŒ‰ä¸Šæ–¹å›¾ç‰‡ä¿å­˜å‘é€ç»™å®¢æˆ·</p>
    </div>

    <div id="canvas-container">
        <canvas id="myCanvas"></canvas>
    </div>

    <script>
        // åˆå§‹åŒ–æ—¥æœŸ
        const today = new Date();
        document.getElementById('custDate').value = `${today.getFullYear()}å¹´${today.getMonth()+1}æœˆ`;

        function generatePoster() {
            const name = document.getElementById('custName').value;
            const date = document.getElementById('custDate').value;
            if(!name) return alert('è¯·è¾“å…¥å®¢æˆ·å§“å');

            // æ£€æŸ¥åº“æ˜¯å¦åŠ è½½æˆåŠŸ
            if (typeof QRious === 'undefined') {
                return alert('äºŒç»´ç æ’ä»¶åŠ è½½ä¸­ï¼Œè¯·ç¨ç­‰3ç§’å†ç‚¹ï¼›æˆ–æ£€æŸ¥ç½‘ç»œæ˜¯å¦æ­£å¸¸ã€‚');
            }

            const currentDir = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);
            const finalUrl = `${currentDir}card.html?n=${encodeURIComponent(name)}&d=${encodeURIComponent(date)}`;

            // 1. å…ˆåœ¨å†…å­˜ä¸­ç”»å‡ºäºŒç»´ç 
            const qr = new QRious({
                value: finalUrl,
                size: 400,
                level: 'H'
            });

            // 2. å‡†å¤‡ä¸»ç”»å¸ƒ
            const mainCanvas = document.getElementById('myCanvas');
            const ctx = mainCanvas.getContext('2d');
            mainCanvas.width = 600;
            mainCanvas.height = 900;

            // 3. ç»˜åˆ¶è¿‡ç¨‹ - å¢åŠ ä¸€ä¸ªå°å»¶è¿Ÿç¡®ä¿å›¾åƒæ•°æ®å°±ç»ª
            setTimeout(() => {
                // å¡«å……èƒŒæ™¯
                ctx.fillStyle = "#d63031";
                ctx.fillRect(0, 0, 600, 900);

                // ç”»é‡‘è¾¹
                ctx.strokeStyle = "#f1c40f";
                ctx.lineWidth = 20;
                ctx.strokeRect(30, 30, 540, 840);

                // æ–‡å­—
                ctx.fillStyle = "#f1c40f";
                ctx.textAlign = "center";
                ctx.font = "bold 50px 'Microsoft YaHei'";
                ctx.fillText("ä¸“å±æ–°æ˜¥è´ºå¡", 300, 150);
                
                ctx.fillStyle = "#ffffff";
                ctx.font = "36px 'Microsoft YaHei'";
                ctx.fillText(`è‡´ï¼š${name}`, 300, 280);

                // ç»˜åˆ¶äºŒç»´ç èƒŒæ™¯ç™½å—
                ctx.fillStyle = "#ffffff";
                ctx.fillRect(140, 340, 320, 320);

                // å…³é”®ç‚¹ï¼šä½¿ç”¨ qr.image è·å–å›¾åƒå¹¶ç”»åˆ°ä¸»ç”»å¸ƒ
                ctx.drawImage(qr.image, 150, 350, 300, 300);

                // åº•éƒ¨æ–‡å­—
                ctx.fillStyle = "#f1c40f";
                ctx.font = "24px 'Microsoft YaHei'";
                ctx.fillText("é•¿æŒ‰è¯†åˆ«äºŒç»´ç  Â· æŸ¥çœ‹åŠ¨æ€è´ºå¡", 300, 800);

                document.getElementById('canvas-container').style.display = 'block';
                document.getElementById('statusTip').style.display = 'block';
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            }, 100); 
        }
    </script>
</body>
</html>
