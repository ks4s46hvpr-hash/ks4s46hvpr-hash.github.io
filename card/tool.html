<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´ºå¡ç”Ÿæˆå·¥å…· - çº¯æœ¬åœ°ç‰ˆ</title>
    <style>
        body { font-family: 'Microsoft YaHei', sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; background: #fff5f5; }
        .box { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); width: 320px; text-align: center; border: 1px solid #ffcfcf; position: relative; z-index: 2; }
        h2 { color: #d63031; margin-top: 0; }
        input { padding: 12px; width: 85%; margin: 10px 0; border: 2px solid #ffcfcf; border-radius: 8px; outline: none; }
        button { padding: 12px; background: #ff4757; color: white; border: none; border-radius: 8px; cursor: pointer; width: 95%; margin-top: 10px; font-weight: bold; font-size: 16px; }
        #canvas-container { margin-top: 20px; display: none; }
        canvas { max-width: 100%; border-radius: 10px; box-shadow: 0 8px 25px rgba(0,0,0,0.15); border: 4px solid #fff; }
        .tip { font-size: 14px; color: #ff7675; margin-top: 12px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="box">
        <h2>ğŸ§§ è´ºå¡ç”Ÿæˆå·¥å…·</h2>
        <input type="text" id="custName" placeholder="å®¢æˆ·å°Šç§° (å¦‚: ç‹æ€»)">
        <input type="text" id="custDate" placeholder="æ—¥æœŸ (å¦‚: 2025å¹´2æœˆ)">
        <button onclick="generatePoster()">ç”ŸæˆäºŒç»´ç å¼•å¯¼å›¾</button>
        <p id="statusTip" class="tip" style="display:none;">â†“ é•¿æŒ‰ä¸Šæ–¹å›¾ç‰‡ä¿å­˜å‘é€ç»™å®¢æˆ·</p>
    </div>

    <div id="canvas-container">
        <canvas id="myCanvas"></canvas>
    </div>

    <!-- å†…ç½®è¿·ä½ äºŒç»´ç ç”Ÿæˆåº“ (QRCode.js å‹ç¼©ç‰ˆ) -->
    <script>
        var QRCode;!function(){function t(t){this.mode=e.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var r=0,i=this.data.length;i>r;r++){var n=this.data.charCodeAt(r);this.parsedData.push(n)}}t.prototype={getLength:function(){return this.parsedData.length},write:function(t){for(var e=0,r=this.parsedData.length;r>e;e++)t.put(this.parsedData[e],8)}},QRCode=function(t,e){this.typeNumber=4,this.errorCorrectLevel=r.H,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[],this.addData(t),this.make()};var e={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},r={L:1,M:0,Q:3,H:2},i=QRCode.prototype;i.addData=function(e){var r=new t(e);this.dataList.push(r),this.dataCache=null},i.make=function(){this.makeImpl(!1,this.getBestTypeNumber())},i.makeImpl=function(t,e){this.typeNumber=e,this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[r][i]=null}this.setupTypeInfo(t,0),this.setupTypeNumber(t),this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,0),this.mapData(this.dataList,0)},i.getBestTypeNumber=function(){for(var t=1;40>t;t++)if(this.dataList[0].getLength()<=100)return t;return 40},i.setupPositionProbePattern=function(t,e){for(var r=-1;7>=r;r++)if(!(-1>=t+r||this.moduleCount<=t+r))for(var i=-1;7>=i;i++)-1>=e+i||this.moduleCount<=e+i||(r>=0&&6>=r&&(0==i||6==i)||i>=0&&6>=i&&(0==r||6==r)||r>=2&&4>=r&&i>=2&&4>=i?this.modules[t+r][e+i]=!0:this.modules[t+r][e+i]=!1)},i.setupTimingPattern=function(){for(var t=8;this.moduleCount-8>t;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;this.moduleCount-8>e;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},i.setupPositionAdjustPattern=function(){for(var t=[6,18,30,42,54,66,78,90,102,114,126,138,150,162],e=0;e<t.length;e++)for(var r=0;r<t.length;r++){var i=t[e],n=t[r];if(null==this.modules[i][n])for(var o=-2;2>=o;o++)for(var s=-2;2>=s;s++)this.modules[i+o][n+s]=-2==o||2==o||-2==s||2==s||0==o&&0==s}},i.setupTypeNumber=function(t){for(var e=0;18>e;e++){var r=!t&&1==((21964>>e)&1);this.modules[Math.floor(e/3)][e%3+this.moduleCount-8-3]=r}for(var e=0;18>e;e++){var r=!t&&1==((21964>>e)&1);this.modules[e%3+this.moduleCount-8-3][Math.floor(e/3)]=r}},i.setupTypeInfo=function(t,e){for(var r=1,i=0;15>i;i++){var n=!t&&1==((13357>>i)&1);11>i?this.modules[i][8]=n:this.modules[this.moduleCount-15+i][8]=n}for(var i=0;15>i;i++){var n=!t&&1==((13357>>i)&1);8>i?this.modules[8][this.moduleCount-i-1]=n:this.modules[8][15-i-1+1]=n}this.modules[this.moduleCount-8][8]=!t},i.mapData=function(t,e){for(var r=-1,i=this.moduleCount-1,n=7,o=1,s=i;s>0;s-=2)for(6==s&&s--;;){for(var a=0;2>a;a++)if(null==this.modules[i][s-a]){var h=!1;e<t.length&&(h=t[e].write());this.modules[i][s-a]=h}if(i+=r,-1>i||this.moduleCount<=i){i-=r,r=-r;break}}}};}()
    </script>

    <script>
        const today = new Date();
        document.getElementById('custDate').value = `${today.getFullYear()}å¹´${today.getMonth()+1}æœˆ`;

        function generatePoster() {
            const name = document.getElementById('custName').value;
            const date = document.getElementById('custDate').value;
            if(!name) return alert('è¯·è¾“å…¥å§“å');

            const currentDir = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);
            const finalUrl = `${currentDir}card.html?n=${encodeURIComponent(name)}&d=${encodeURIComponent(date)}`;

            // 1. è°ƒç”¨å†…ç½®åº“ç”ŸæˆäºŒç»´ç çŸ©é˜µ
            const qr = new QRCode(finalUrl);
            const modules = qr.modules;
            const tileW = 300 / modules.length;

            const mainCanvas = document.getElementById('myCanvas');
            const ctx = mainCanvas.getContext('2d');
            mainCanvas.width = 600;
            mainCanvas.height = 900;

            // 2. ç»˜åˆ¶æµ·æŠ¥
            ctx.fillStyle = "#d63031"; // çº¢è‰²èƒŒæ™¯
            ctx.fillRect(0, 0, 600, 900);
            ctx.strokeStyle = "#f1c40f"; // é‡‘è‰²è¾¹æ¡†
            ctx.lineWidth = 20;
            ctx.strokeRect(30, 30, 540, 840);

            ctx.fillStyle = "#f1c40f";
            ctx.textAlign = "center";
            ctx.font = "bold 50px 'Microsoft YaHei'";
            ctx.fillText("ä¸“å±æ–°æ˜¥è´ºå¡", 300, 150);
            
            ctx.fillStyle = "#ffffff";
            ctx.font = "36px 'Microsoft YaHei'";
            ctx.fillText(`è‡´ï¼š${name}`, 300, 280);

            // 3. ç»˜åˆ¶äºŒç»´ç  (ç™½åº•)
            ctx.fillStyle = "#ffffff";
            ctx.fillRect(150, 350, 300, 300);
            
            // å¾ªç¯çŸ©é˜µæ‰‹åŠ¨ç”»å‡ºäºŒç»´ç é»‘å—
            ctx.fillStyle = "#000000";
            for (var row = 0; row < modules.length; row++) {
                for (var col = 0; col < modules.length; col++) {
                    if (modules[row][col]) {
                        ctx.fillRect(150 + col * tileW, 350 + row * tileW, tileW + 0.5, tileW + 0.5);
                    }
                }
            }

            ctx.fillStyle = "#f1c40f";
            ctx.font = "24px 'Microsoft YaHei'";
            ctx.fillText("é•¿æŒ‰è¯†åˆ«äºŒç»´ç  Â· æŸ¥çœ‹åŠ¨æ€è´ºå¡", 300, 800);

            document.getElementById('canvas-container').style.display = 'block';
            document.getElementById('statusTip').style.display = 'block';
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }
    </script>
</body>
</html>
