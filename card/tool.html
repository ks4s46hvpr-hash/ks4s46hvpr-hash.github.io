<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026È©¨Âπ¥Ë¥∫Âç°</title>
    <!-- Âº∫Âà∂ËØ∑Ê±ÇÁÆÄ‰Ωì‰∏≠ÊñáÂ≠óÁ¨¶ÈõÜÔºåÈò≤Ê≠¢ÂõûÈÄÄÂà∞ÁπÅ‰Ωì -->
    <link rel="stylesheet" href="https://fonts.googleapis.com">
    <style>
        body { font-family: 'Noto Sans SC', 'Microsoft YaHei', sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; background: #f0ebe5; }
        .box { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 380px; text-align: center; }
        h2 { color: #b10405; margin-top: 0; font-size: 22px; }
        input { padding: 12px; width: 85%; border: 1.5px solid #ddd; border-radius: 8px; margin: 15px 0; font-size: 16px; text-align: center; font-weight: bold; outline: none; }
        input:focus { border-color: #b10405; }
        button { padding: 14px 25px; background: #b10405; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 95%; font-size: 16px; }
        button:hover { background: #d40506; }
        .status { font-size: 12px; color: #888; margin-bottom: 10px; }
        .preview-label { margin-top: 10px; font-size: 13px; color: #999; font-weight: bold; }
        canvas { max-width: 100%; margin-top: 10px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); background: #eee; }
    </style>
</head>
<body>
    <div class="box">
        <h2>üßß 2026 Ë¥∫Âç°Âà∂‰Ωú</h2>
        <div id="fontStatus" class="status">Ê≠£Âú®ÂáÜÂ§áÈ´òÊ∏ÖÁÆÄ‰ΩìÂ≠óÂ∫ì...</div>
        <input type="text" id="custName" placeholder="ËæìÂÖ•‰ºÅ‰∏öÂêçÁß∞" oninput="drawPreview()">
        <button onclick="generate()">ÁîüÊàêÂπ∂‰∏ãËΩΩ</button>
        <div class="preview-label">ÂÆûÊó∂È¢ÑËßà</div>
        <canvas id="previewCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('previewCanvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.src = "bg.png"; 

        // Ê£ÄÊµã Windows Á≥ªÁªü
        const isWindows = navigator.platform.toLowerCase().includes('win');

        const CONFIG = {
            fontSize: 27,
            color: "#b10405",
            startX_ratio: 0.600,
            startY_ratio: 0.369,
            endX_ratio: 0.844,
            maxLineChars: 15,
            // Windows ‰ΩøÁî® 0.2ÔºåÂÖ∂‰ªñÔºàMacÁ≠âÔºâ‰ΩøÁî® 0.4
            strokeWeight: isWindows ? 0.2 : 0.4 
        };

        // Â≠ó‰ΩìÂä†ËΩΩÂ§ÑÁêÜ
        document.fonts.ready.then(() => {
            document.getElementById('fontStatus').innerText = `‚úÖ ÁÆÄ‰ΩìÂ≠óÂ∫ìÂ∞±Áª™ (${isWindows ? 'WinÊ®°Âºè' : 'Ê†áÂáÜÊ®°Âºè'})`;
            if(img.complete) drawPreview();
        });

        img.onload = () => drawPreview();

        function drawContent(targetCanvas) {
            const tCtx = targetCanvas.getContext('2d');
            targetCanvas.width = img.width;
            targetCanvas.height = img.height;
            tCtx.drawImage(img, 0, 0);

            const name = document.getElementById('custName').value.trim();
            if (!name) return;

            const fullText = `Ëá¥${name}Ôºö`;
            const lineHeight = CONFIG.fontSize * 1.4;
            
            const startX = (targetCanvas.width * CONFIG.startX_ratio) - (CONFIG.fontSize * 0.5);
            const startY = (targetCanvas.height * CONFIG.startY_ratio) - lineHeight;
            const endXLimit = targetCanvas.width * CONFIG.endX_ratio;

            // Â≠ó‰ΩìÂä†Á≤óÂ¢ûÂº∫Ôºö‰ºòÂÖà‰ΩøÁî® Noto Sans SC
            tCtx.font = `900 ${CONFIG.fontSize}px "Noto Sans SC", "Source Han Sans CN", "Microsoft YaHei", sans-serif`;
            tCtx.fillStyle = CONFIG.color;
            tCtx.strokeStyle = CONFIG.color; 
            tCtx.lineWidth = CONFIG.strokeWeight; 
            tCtx.textAlign = "left";
            tCtx.textBaseline = "top";

            let curX = startX;
            let curY = startY;

            for (let i = 0; i < fullText.length; i++) {
                const char = fullText[i];
                const charWidth = tCtx.measureText(char).width;

                const isColon = (char === "Ôºö" || char === ":");
                const shouldWrap = (i > 0 && i % CONFIG.maxLineChars === 0) || (curX + charWidth > endXLimit);

                if (shouldWrap && !isColon) {
                    curX = startX;
                    curY += lineHeight;
                }

                tCtx.fillText(char, curX, curY);
                if (CONFIG.strokeWeight > 0) {
                    tCtx.strokeText(char, curX, curY); 
                }
                curX += charWidth + 2;
            }
        }

        function drawPreview() {
            if (img.complete) drawContent(canvas);
        }

        function generate() {
            const name = document.getElementById('custName').value.trim();
            if(!name) return alert('ËØ∑ËæìÂÖ•ÂêçÁß∞');
            drawContent(canvas); 
            const link = document.createElement('a');
            link.download = `2026È©¨Âπ¥Ë¥∫Âç°_${name}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
    </script>
</body>
</html>
