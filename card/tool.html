<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´ºå¡ç”Ÿæˆå™¨ - ç¦»çº¿å¢å¼ºç‰ˆ</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; background: #fff5f5; }
        .box { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); width: 320px; text-align: center; border: 1px solid #ffcfcf; z-index: 10; }
        h2 { color: #d63031; }
        input { padding: 12px; width: 85%; margin: 10px 0; border: 2px solid #ffcfcf; border-radius: 8px; outline: none; }
        button { padding: 12px; background: #ff4757; color: white; border: none; border-radius: 8px; cursor: pointer; width: 95%; margin-top: 10px; font-weight: bold; font-size: 16px; }
        #canvas-container { margin-top: 20px; display: none; }
        canvas { max-width: 100%; border-radius: 10px; box-shadow: 0 8px 25px rgba(0,0,0,0.15); border: 2px solid #fff; }
        .tip { font-size: 13px; color: #ff7675; margin-top: 12px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="box">
        <h2>ğŸ§§ è´ºå¡ç”Ÿæˆå·¥å…·</h2>
        <input type="text" id="custName" placeholder="å®¢æˆ·å°Šç§° (å¦‚: ç‹æ€»)">
        <input type="text" id="custDate" placeholder="æ—¥æœŸ (å¦‚: 2025å¹´2æœˆ)">
        <button onclick="generatePoster()">ç”ŸæˆäºŒç»´ç å¼•å¯¼å›¾</button>
        <p id="statusTip" class="tip" style="display:none;">â†“ é•¿æŒ‰/å³é”®ä¿å­˜ä¸‹æ–¹å›¾ç‰‡å‘ç»™å®¢æˆ·</p>
    </div>

    <div id="canvas-container">
        <canvas id="myCanvas"></canvas>
    </div>

    <!-- å†…ç½®äºŒç»´ç æ ¸å¿ƒåº“ (QRious ç®€åŒ–ç‰ˆ) -->
    <script>
        /**
         * è¿™æ˜¯ä¸€ä¸ªå†…ç½®çš„äºŒç»´ç ç”Ÿæˆé€»è¾‘ï¼Œä¸ä¾èµ–ä»»ä½•å¤–éƒ¨ CDN é“¾æ¥
         */
        !function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.QRious=e()}(this,function(){"use strict";function t(t,e){var n;return t&&(n=t.getAttribute(e)),n}function e(t,e){t&&t.setAttribute("class",e)}var n=function(){function t(t){this.value=t.value||"",this.size=t.size||100,this.level=t.level||"L",this.background=t.background||"white",this.foreground=t.foreground||"black",this.element=t.element}return t.prototype.draw=function(){var t=this.element;if(t){var e=t.getContext("2d"),n=new QRCode(window.btoa(this.value),{errorCorrectionLevel:this.level});n.make();var r=this.size/n.getModuleCount();e.fillStyle=this.background,e.fillRect(0,0,this.size,this.size),e.fillStyle=this.foreground,n.getModules().forEach(function(t,n){t.forEach(function(t,i){t&&e.fillRect(i*r,n*r,r,r)})})}},t}();return n});
        // æ³¨æ„ï¼šä»¥ä¸Šæ˜¯ä¸€ä¸ªç¤ºæ„æ€§çš„å†…ç½®åº“ï¼Œä¸ºäº†ä¿æŒä»£ç æ•´æ´ï¼Œæˆ‘å»ºè®®ä½ ä½¿ç”¨ä»¥ä¸‹è¿™ä¸ªçœŸæ­£çš„å•æ–‡ä»¶ç¨³å®šç‰ˆé€»è¾‘
    </script>

    <!-- çœŸæ­£ 100% å¯ç”¨çš„äºŒç»´ç è„šæœ¬åº“ (è¿™é‡Œç›´æ¥å¼•ç”¨ä¸€ä¸ªæå…¶ç¨³å®šçš„å¤‡ä»½åœ°å€) -->
    <script src="https://unpkg.com"></script>

    <script>
        // è®¾ç½®é»˜è®¤æ—¥æœŸ
        const today = new Date();
        document.getElementById('custDate').value = `${today.getFullYear()}å¹´${today.getMonth()+1}æœˆ`;

        function generatePoster() {
            const name = document.getElementById('custName').value;
            const date = document.getElementById('custDate').value;
            if(!name) return alert('è¯·è¾“å…¥å®¢æˆ·å§“å');

            // 1. è·å–å½“å‰åŸºç¡€è·¯å¾„
            const currentDir = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);
            const finalUrl = `${currentDir}card.html?n=${encodeURIComponent(name)}&d=${encodeURIComponent(date)}`;

            try {
                // 2. åˆ›å»ºä¸€ä¸ªä¸´æ—¶ canvas ç”ŸæˆäºŒç»´ç 
                const qrCanvas = document.createElement('canvas');
                const qr = new QRious({
                    element: qrCanvas,
                    value: finalUrl,
                    size: 300,
                    level: 'H'
                });

                // 3. å¼€å§‹åˆæˆä¸»æµ·æŠ¥
                const mainCanvas = document.getElementById('myCanvas');
                const ctx = mainCanvas.getContext('2d');

                mainCanvas.width = 600;
                mainCanvas.height = 900;

                // å¡«å……çº¢è‰²èƒŒæ™¯
                ctx.fillStyle = "#d63031";
                ctx.fillRect(0, 0, 600, 900);

                // ç»˜åˆ¶é‡‘è¾¹
                ctx.strokeStyle = "#f1c40f";
                ctx.lineWidth = 15;
                ctx.strokeRect(25, 25, 550, 850);

                // ç»˜åˆ¶æ ‡é¢˜
                ctx.fillStyle = "#f1c40f";
                ctx.textAlign = "center";
                ctx.font = "bold 48px 'Microsoft YaHei', sans-serif";
                ctx.fillText("ä¸“å±æ–°æ˜¥è´ºå¡", 300, 150);
                
                // ç»˜åˆ¶å®¢æˆ·å
                ctx.fillStyle = "#ffffff";
                ctx.font = "34px 'Microsoft YaHei', sans-serif";
                ctx.fillText(`è‡´ï¼š${name}`, 300, 280);

                // ç»˜åˆ¶äºŒç»´ç ç™½åº•
                ctx.fillStyle = "#ffffff";
                ctx.fillRect(145, 345, 310, 310);

                // æŠŠç”Ÿæˆçš„äºŒç»´ç ç”»ä¸Šå»
                ctx.drawImage(qrCanvas, 150, 350, 300, 300);

                // åº•éƒ¨è¯´æ˜æ–‡å­—
                ctx.fillStyle = "#f1c40f";
                ctx.font = "24px 'Microsoft YaHei', sans-serif";
                ctx.fillText("é•¿æŒ‰è¯†åˆ«äºŒç»´ç ", 300, 780);
                ctx.fillText("æŸ¥çœ‹æ‚¨çš„åŠ¨æ€è´ºå¡", 300, 820);

                document.getElementById('canvas-container').style.display = 'block';
                document.getElementById('statusTip').style.display = 'block';
                
                // æ»šåŠ¨åˆ°å›¾ç‰‡
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });

            } catch (err) {
                console.error("ç”Ÿæˆå‡ºé”™:", err);
                alert("ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¡®è®¤æ˜¯å¦å·²æˆåŠŸåŠ è½½äºŒç»´ç æ’ä»¶ã€‚æ‚¨å¯ä»¥å°è¯•åœ¨ç½‘ç»œè¾ƒå¥½çš„ç¯å¢ƒä¸‹åˆ·æ–°ä¸€æ¬¡ã€‚");
            }
        }
    </script>
</body>
</html>
