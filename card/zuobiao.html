<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´ºå¡ä½ç½®æ¢æµ‹å·¥å…·</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; background: #f0f0f0; }
        .box { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 340px; text-align: center; margin-bottom: 20px; }
        input { padding: 10px; width: 80%; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; }
        button { padding: 12px; background: #e74c3c; color: white; border: none; border-radius: 6px; cursor: pointer; width: 90%; font-weight: bold; }
        #previewCanvas { max-width: 95%; border: 2px dashed #999; cursor: crosshair; margin-top: 20px; }
        .info-panel { margin-top: 15px; padding: 10px; background: #fff3cd; border: 1px solid #ffeeba; border-radius: 5px; font-size: 13px; line-height: 1.6; width: 340px; }
    </style>
</head>
<body>
    <div class="box">
        <h2>ğŸ›  åæ ‡æ¢æµ‹ç”Ÿæˆå™¨</h2>
        <input type="text" id="custName" placeholder="éšä¾¿è¾“ä¸ªåå­—æµ‹è¯•ä½ç½®">
        <button onclick="generate()">ç¬¬ä¸€æ­¥ï¼šç‚¹å‡»ç”Ÿæˆé¢„è§ˆ</button>
        <div class="info-panel" id="resultPanel">
            <strong>æ“ä½œæŒ‡å—ï¼š</strong><br>
            1. ç‚¹å‡»ç”Ÿæˆé¢„è§ˆå›¾<br>
            2. <strong>ç›´æ¥åœ¨ä¸‹æ–¹å›¾ç‰‡ä¸Šç‚¹å‡»</strong>ä½ æƒ³è®©â€œè‡´â€å­—å¼€å§‹çš„ä½ç½®<br>
            3. å¼¹çª—ä¼šç»™å‡ºå¯¹åº”çš„ä»£ç ç³»æ•°
        </div>
    </div>

    <canvas id="previewCanvas"></canvas>

    <script>
        async function generate() {
            let name = document.getElementById('custName').value || "æµ‹è¯•ä¼ä¸šåç§°";
            const canvas = document.getElementById('previewCanvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.crossOrigin = "anonymous";
            img.src = "bg.png?t=" + new Date().getTime(); // åŠ ä¸ªæ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜æ—§å›¾

            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);

                // é»˜è®¤ç»˜åˆ¶ä¸€æ¬¡ï¼ˆåˆå§‹ä½ç½®ï¼‰
                drawText(ctx, canvas, name, 0.85, 0.15);
                
                // ç»‘å®šç‚¹å‡»æ¢æµ‹äº‹ä»¶
                canvas.onclick = function(e) {
                    const rect = canvas.getBoundingClientRect();
                    const scaleX = canvas.width / rect.width;
                    const scaleY = canvas.height / rect.height;
                    const clickX = (e.clientX - rect.left) * scaleX;
                    const clickY = (e.clientY - rect.top) * scaleY;

                    // è®¡ç®—æ¯”ä¾‹ç³»æ•°
                    const ratioX = (clickX / canvas.width).toFixed(3);
                    const ratioY = (clickY / canvas.height).toFixed(3);

                    // å¼¹çª—å‘ŠçŸ¥å¹¶å®æ—¶é‡ç»˜æµ‹è¯•
                    const msg = `æ¢æµ‹æˆåŠŸï¼\næ¨ªå‘æ¯”ä¾‹ (startX): ${ratioX}\nçºµå‘æ¯”ä¾‹ (startY): ${ratioY}\n\nè¯·è®°å½•è¿™ä¸¤ä¸ªæ•°å­—ï¼Œå¡«å…¥ä»£ç ä¸­å³å¯ã€‚`;
                    alert(msg);
                    
                    // é‡æ–°ç»˜åˆ¶åº•å›¾å’Œæ–°ä½ç½®çš„æ–‡å­—
                    ctx.drawImage(img, 0, 0);
                    drawText(ctx, canvas, name, ratioX, ratioY);
                };
            };
            img.onerror = () => alert("æœªæ‰¾åˆ° bg.jpgï¼Œè¯·ç¡®ä¿å›¾ç‰‡å·²ä¸Šä¼ åˆ° card æ–‡ä»¶å¤¹ã€‚");
        }

        function drawText(ctx, canvas, name, rX, rY) {
            const fontSize = Math.floor(canvas.width * 0.05);
            ctx.fillStyle = "#D4AF37"; 
            ctx.font = `bold ${fontSize}px "STKaiti", "KaiTi", serif`;
            ctx.textAlign = "center";
            ctx.textBaseline = "top";

            let startX = canvas.width * rX; 
            let startY = canvas.height * rY;
            
            // ç”»â€œè‡´â€
            ctx.font = `bold ${fontSize * 0.7}px "STKaiti", "KaiTi", serif`;
            ctx.fillText("è‡´", startX, startY);
            
            // ç”»åå­—
            ctx.font = `bold ${fontSize}px "STKaiti", "KaiTi", serif`;
            const chars = name.split('');
            let curY = startY + fontSize * 1.0; 
            chars.forEach(char => {
                ctx.fillText(char, startX, curY);
                curY += fontSize * 1.2;
            });
        }
    </script>
</body>
</html>
